pkgname=rocksdb
pkgver=5.15.10
pkgrel=1
pkgdesc='Embedded key-value store for fast storage'
arch=(i686 x86_64)
url='http://rocksdb.org'
license=(Apache leveldb)
depends=()
source=(https://github.com/facebook/rocksdb/archive/v$pkgver.zip)
md5sums=('SKIP')

prepare() {
  cd rocksdb-$pkgver
  sed -e 's/\bpython\b/python2/' -i Makefile
}

build() {
  cd rocksdb-$pkgver
  make release -j4
  make shared_lib -j4
  make db_bench -j4
}

package() {
  cd rocksdb-$pkgver
  install -d "$pkgdir"/usr/include
  install -d "$pkgdir"/usr/share/rocksdb
  cp -r include/rocksdb "$pkgdir"/usr/include
  install -m755 -D librocksdb.so "$pkgdir"/usr/lib/librocksdb.so
  rm tools/*.o
  rm tools/*.d
  cp -r tools "$pkgdir"/usr/share/rocksdb
  install -m755 -D db_bench "$pkgdir"/usr/share/rocksdb/tools
}
