#!/bin/sh
# - runtime
# - nr_threads
# - protocol

[ -n "$nr_threads" ] && opt_streams="-n $nr_threads"
[ "${protocol#udp}" != "$protocol" ]	&& opt_udp=-u
[ "${protocol%6}" != "$protocol" ]	&& opt_addr='::1' || opt_addr='127.0.0.1'
[ -n "$runtime" ] || runtime=300

cd $BENCHMARK_ROOT/nepim || exit

cmd ./nepim >/dev/null 2>&1 &
pid=$!

sleep 1

cmd ./nepim -c $opt_addr -d $opt_udp -a $runtime $opt_streams 2>&1

kill $pid
