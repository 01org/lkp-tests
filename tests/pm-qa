#!/bin/sh
# - test

cd $BENCHMARK_ROOT/pm-qa || exit

run_one()
{
	local testcase=$1
	if [ "$testcase" = 'cpuhotplug' ]; then
		ext_opt='hotplug_allow_cpu0=0'
	else
		ext_opt=
	fi

	cmd make -C $testcase $ext_opt run_tests

	ls $BENCHMARK_ROOT/pm-qa/$testcase/*.log >/dev/null && { 2>&1
		chmod g+w	$BENCHMARK_ROOT/pm-qa/$testcase/*.log
		chown lkp.lkp	$BENCHMARK_ROOT/pm-qa/$testcase/*.log
		cp -a		$BENCHMARK_ROOT/pm-qa/$testcase/*.log $RESULT_ROOT/
	}
}

if [ "$test" = 'all' ]; then
	for i in cpufreq cpuhotplug cputopology cpuidle thermal
	do
		run_one $i
	done
else
	run_one $test
fi
