#!/bin/sh
# - runtime
# - test
# - nr_task

cd $BENCHMARK_ROOT/will-it-scale || exit

. $LKP_SRC/lib/sysinfo.sh

setup_params()
{
	[ -n "$runtime" ] || runtime=300
	WARMUP_ITERATIONS=5 # defined in will-it-scale/main.c
	iterations=$((3 + nr_node))
	duration=$(( runtime / iterations / 2 - WARMUP_ITERATIONS ))
	[ "$duration" -lt 5  ] && duration=5
}

setup_threads_to_iterate
setup_params

threads_to_iterate=${nr_task:-$threads_to_iterate}

cmd ./runtest.py $test $duration $threads_to_iterate
