#!/bin/bash
# - group

. $LKP_SRC/lib/debug.sh
. $LKP_SRC/lib/upload.sh

test_file=$BENCHMARK_ROOT/igt/$group

cd "$BENCHMARK_ROOT/igt" || exit

while read testcase
do
	# OOM since igt commit: 0b0eaa353 ("tests/dumb_buffer: Try to compute the largest possible dumb buffer")
	# disable it until we get response from community
	[ "$testcase" = "dumb_buffer" ] && continue

	subtests=$(build/tests/$testcase --list-subtest)
	for subtest in ${subtests[@]}
	do
		echo $subtest | grep suspend && continue

		log_cmd build/tests/$testcase --run-subtest $subtest 2>&1

		# #define IGT_EXIT_ABORT 112
		# Exit status indicating a severe test/enviroment failure, any continued
		# testing past this point can yeild unexpected reasults and is not recommended
		[ $? -eq 112 ] && exit 112
	done
done < $test_file
