#!/bin/bash

source $LKP_SRC/lib/result.sh

shopt -s nullglob

remove_from_mrtts()
{
    local dir=$1
    is_mrt $dir && echo $dir | lkp delete_mrts
}

remove()
{
	cleanup_path_record_from_patterns $patterns || exit
	cat $temp_file | xargs rm -rf
}

usage()
{
	cat >&2 <<-EOF
Usage: lkp $script_name <patterns>
For example:
lkp $script_name /xfstests/ /lkp-ws02/ /v4.3/
EOF
	exit 1
}

script_name=$(basename $0)
[[ $# = 0 ]] && usage

patterns="$*"

temp_file=$(mktemp)
lkp _rt $patterns > $temp_file

[[ -s "$temp_file" ]] ||
{
	rm -f $temp_file
	echo "Cannot find the match _result_root according to the patterns: $patterns" >&2
	exit 1
}

{
echo "Warning:"
echo "\"lkp _rt $patterns\" will be used to search the _resutl_root."
echo "\"lkp rm $patterns\" will remove the following _result_root."
echo

cat $temp_file
} | more

echo -n "!!! Do you really want to do that? [No/yes]: "
read answer
if [[ $answer = "yes" ]]; then

	while read path
	do
		remove_from_mrtts $path
	done < $temp_file

	remove

	echo "Done" >&2
fi

rm $temp_file

