#!/bin/bash -e

[[ $LKP_SRC ]] || export LKP_SRC="$(dirname $(dirname $(realpath $0)))"

usage() { echo "Usage: $0 [-a <arch>] [-c] [-d] -n <BM_NAME>"; exit 1; }

while getopts "a:cdn:" opt
do
	case $opt in
	a ) arch="$OPTARG" ;;
	c ) opt_clean=true ;;
	d ) opt_deb=true ;;
	n ) BM_NAME="$OPTARG" ;;
	? ) usage ;;
	esac
done

[[ $BM_NAME ]] || usage
BM_ROOT=/lkp/benchmarks/$BM_NAME

source $LKP_SRC/pack/default
source $LKP_SRC/pack/$BM_NAME

rm -fr "$BM_ROOT"
mkdir -p $BM_ROOT

cd /tmp

download
build
install
if [[ $opt_deb ]]; then
	pack_deb
else
	pack
fi

[[ $opt_clean ]] && cleanup
